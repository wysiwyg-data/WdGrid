/**
 * wdgrid js data grid class 1.1
 *
 * File: wdgrid.min.js
 *
 * http://github.com/
 *
 * Author: Pierrick Parigot <pierrick@wysiwyg-data.co.nz>
 * Copyright (c) 2024 WISYWIG Data
 *
 * Licensed under the MIT licenses:
 * http://www.opensource.org/licenses/mit-license.php
**/
"undefined"!=typeof vGenStrings&&"undefined"!=typeof vLocaleOpts||(alert("The localisation file has not been loaded.\nThis file is needed to use WdGrid."),vGenStrings={},vLocaleOpts={});class WdGrid{constructor({parent_element:e="",grid_element:t="",module:i="",security:s={},user_id:d="",themes_path:c="",app_theme:a="",locale:r="en-NZ",currency_dec:l=2,float_dec:o=2,max_height:n="400",show_title:g=!0,show_deleted_opt:h=!0,show_new_opt:_=!1,warn_no_uuid:u=!0,uuid_col:w="",delete_col:v="",show_deleted:m="1",nav_type:D="simple",offsets:f={10:"10",25:"25",50:"50",100:"100",250:"250",500:"500"},offset:y="10",query_cols:I="*",ajax_data_func:p="",db_table:S="",grid_cols:M=[],grid_cols_type:b=[],grid_cols_width:N=[],grid_cols_align:C=[],grid_labels_align:O=[],sortable_cols:E=[],order_by:T="0",order_dir:H="0",order_cols_main:x=[],order_cols_other:L=[],hidden_cols:R=[],hidden_cols_type:B=[],fixed_filter_on:A="-",fixed_filter_opnd:F="=",use_filters:P=!1}){this.cDOMParentElement=e,this.cGridDOMElement=t,this.cSecurity=s,this.cHasSecurity=!0,this.cUserId=d,this.cModule=i,this.cImagesPath=c+a+"/images/",this.cLocale=r,this.cCurrencyDec=l,this.cFloatDec=o,this.cMaxHeight=Number(n),this.cShowTitle=g,this.cShowDeletedOpt=h,this.cShowNewOpt=_,this.cWarnNoUuid=u,this.cUuidCol=w,this.cHasUuidCol=!0,this.cDeleteCol=v,this.cShowDeleted=Number(m),this.cNavType=D,this.cOffsets=f,this.cOffset=Number(y),this.cQueryCols=I,this.cAjaxDataFunc=p,this.DbTable=S,this.cGridCols=M,this.cGridColsType=b,this.cGridColsWidth=N,this.cGridColsAlign=C,this.cGridLabelsAlign=O,this.cSortableCols=E,this.cColCount=M.length,this.cOrderBy=Number(T),this.cOrderDir=Number(H),this.cOrderDirs=["ASC","DESC"],this.cOrderColsMain=x,this.cOrderColsOther=L,this.cHiddenCols=R,this.cHiddenColsType=B,this.cHidColCount=R.length,this.cFixedFilterOn=A,this.cFixedFilterOpnd=F,this.cUseFilters=P,this.cImgDelete="icon_delete.png",this.cImgCheck="check_checked.png",this.cImgUnCheck="check_unchecked.png",this.cImgSortAsc="icon_sort_asc.png",this.cImgSortDsc="icon_sort_desc.png",this.cImgSortNone="icon_sort_none.png",this.cImgNew="icon_new.png",this.cImgSDIdle="slide-down_idle.png",this.cImgSDHover="slide-down_hover.png",this.cImgSUIdle="slide-up_idle.png",this.cImgSUHover="slide-up_hover.png",this.cImgFIdle="icon_first_idle.png",this.cImgFHover="icon_first_hover.png",this.cImgPIdle="icon_prev_idle.png",this.cImgPHover="icon_prev_hover.png",this.cImgNIdle="icon_next_idle.png",this.cImgNHover="icon_next_hover.png",this.cImgLIdle="icon_last_idle.png",this.cImgLHover="icon_last_hover.png",this.cSearchOn="",this.cSearchFor="",this.cDataWidth=0,this.cMaxWidth=0,this.cStartRow=0,this.cTotRecs=0,this.cSelRecs=0,this.cNavAction="first",this.cFixedFilterWhat="-",this.cSearchWhat="-",this.cGridHTML="",this.cStrings=js_grid_strings(i),""==this.cUuidCol&&(this.cHasUuidCol=!1),0==this.cGridLabelsAlign.length&&(this.cGridLabelsAlign=this.cGridColsAlign)}get wg_NewGrid(){try{this.wg_check_grid(),this.wg_set_grid_width(),this.wg_render_grid_html(),this.wg_do_col_headers(),""!=this.cDeleteCol&&1==this.cShowDeletedOpt&&this.wg_init_checkbox("wd_Dg"+this.cModule+"ShowDelsTrigger"),this.wg_set_query_cols(),this.wg_refresh_grid_data(),this.wg_set_grid_listeners()}catch(e){console.log(e)}}get wg_RefreshGrid(){try{this.wg_refresh_grid_data()}catch(e){console.log(e)}}wg_check_grid(){0==this.cHasUuidCol&&1==this.cWarnNoUuid&&alert(vGenStrings.noUUId),0==Object.keys(this.cSecurity).length?(this.cSecurity={},this.cHasSecurity=!1):this.cHasSecurity=!0}wg_set_grid_width(){for(var e=0;e<this.cColCount;e++)this.cDataWidth+=Number(this.cGridColsWidth[e]);this.cMaxWidth=this.cDataWidth+150}wg_set_query_cols(){var e=this.cQueryCols;"object"==typeof e&&(""!=this.cUuidCol&&e.push(this.cUuidCol),""!=this.cDeleteCol&&e.push(this.cDeleteCol)),this.cQueryCols=e}wg_render_grid_html(){var e='<div class="wd_DgWrapper" style="width:'+this.cMaxWidth+"px;height:"+this.cMaxHeight+'px;">';1==this.cShowTitle&&(e+='<div class="wd_DgTitle">',Object.keys(this.cStrings.searchIn).length>0&&(e+='<div class="wd_DgFlexSubDiv-f"><p class="wd_DgTitleText">'+vGenStrings.searchOn+'</p></div><div class="wd_DgFlexSubDiv-f"><p class="wd_DgTitleInput"><select id="wd_Dg'+this.cModule+'SearchOn" size="1" class="wd_DgInputBox" title="'+vGenStrings.searchOnTt+'">'+this.wg_do_select_options(this.cStrings.searchIn)+'</select></p></div><div class="wd_DgFlexSubDiv-f"><p class="wd_DgTitleText">'+vGenStrings.searchFor+'</p></div><div class="wd_DgFlexSubDiv-f"><p class="wd_DgTitleInput"><input type="text" value="" id="wd_Dg'+this.cModule+'SearchFor" maxlength="50" style="width:150px;" size="50" class="wd_DgInputBox" title="'+vGenStrings.searchForTt+'" /></p></div><div class="wd_DgFlexSubDiv-f"><span id="wd_Dg'+this.cModule+'RemoveFilterTrigger"><a href="#" title="'+vGenStrings.filterOff+'"><img src="'+this.cImagesPath+this.cImgDelete+'" alt="remove filter" class="wd_DgNoFilterImg" /></a></span></div>'),""==this.cDeleteCol||0==this.cShowDeletedOpt?e+='<div class="wd_DgFlexSubDiv-gs">&nbsp;</div>':e+='<div class="wd_DgFlexSubDiv-gs"><p class="wd_DgTitleText wd_DgShowDel">'+this.cStrings.incDels+'&nbsp;<input type="hidden" name="wd_Dg'+this.cModule+'ShowDels" id="wd_Dg'+this.cModule+'ShowDels" value="" /></p></div><div class="wd_DgFlexSubDiv-f"><a href="#"> <p class="wd_DgTitleImg"><img src="'+this.cImagesPath+this.cImgUnCheck+'" id="wd_Dg'+this.cModule+'ShowDelsTrigger" alt="" /></p></a></div>',e+="</div>"),e+='<div class="wd_DgHeader">'+this.wg_do_blank_column(15)+'<div id="wd_Dg'+this.cModule+'ColHeader" class="wd_DgDataHeader" style="width:'+this.cDataWidth+'px;"></div>',e+=this.wg_do_blank_column(110),(0==this.cHasSecurity||1==this.cHasSecurity&&"new"in this.cSecurity&&1==Number(this.cSecurity.new))&&1==this.cHasUuidCol&&1==this.cShowNewOpt?e+='<div class="wd_DgFlexSubDiv-f wd_DgNewImgDiv"><a href="#" title="'+this.cStrings.newRow+'"><p><img src="'+this.cImagesPath+this.cImgNew+'" id="wd_Dg'+this.cModule+'AddNewImgTrigger" alt="new" /></p></a></div>':e+=this.wg_do_blank_column(20),e+="</div>";var t=72;""==this.cDeleteCol||1!=this.cShowTitle&&1!=this.cShowDeletedOpt||(t=112),e+='<div id="wd_Dg'+this.cModule+'DataDiv" class="wd_DgTable" style="height:'+(this.cMaxHeight-t)+'px;"><div id="wd_Dg'+this.cModule+'DataTable" style="width:'+(this.cMaxWidth-15)+'px;"></div></div><div class="wd_DgFooter"><div class="wd_DgFlexSubDiv-gs"><p class="wd_DgFooterText"><span id="wd_Dg'+this.cModule+'TotRecsSpan"></span> '+vGenStrings.totRecs+' <span id="wd_Dg'+this.cModule+'SelRecsSpan"></span> '+vGenStrings.selRecs+'</p></div><div class="wd_DgFlexSubDiv-f" id="wd_Dg'+this.cModule+'NavDiv"><div class="wd_NavControls">'+this.wg_do_simple_nav()+"</div></div></div>",e+="</div>";var i=document.createElement("div");i.setAttribute("id",this.cGridDOMElement),i.innerHTML=DOMPurify.sanitize(e),document.getElementById(this.cDOMParentElement).appendChild(i)}wg_do_col_headers(){for(var e="",t=0;t<this.cColCount;t++){var i="";if(""!=this.cGridLabelsAlign[t]&&(i='style="text-align:'+this.cGridLabelsAlign[t]+';"'),1==this.cSortableCols[t]){if(e+='<div class="wd_DgFlexSubDiv-f wd_DgSortImgDiv">',t==this.cOrderBy)if(0==this.cOrderDir){var s=this.cImagesPath+this.cImgSortAsc;e+='<p><img id="wd_Dg'+this.cModule+"SortImg"+t+'" src="'+s+'" alt="sort" /></p>'}else{s=this.cImagesPath+this.cImgSortDsc;e+='<p><img id="wd_Dg'+this.cModule+"SortImg"+t+'" src="'+s+'" alt="sort" /></p>'}else{s=this.cImagesPath+this.cImgSortNone;e+='<p><img id="wd_Dg'+this.cModule+"SortImg"+t+'" src="'+s+'" alt="sort" /></p>'}e+='</div><div class="wd_DgFlexSubDiv-f" style="width:'+(Number(this.cGridColsWidth[t])-14)+'px;"><p class="wd_DgHeaderText" '+i+'><span class="wd_Dg'+this.cModule+'HeaderTrigger"><a href="#" data-colId="'+t+'" title="'+vGenStrings.sort+'">'+this.cStrings.gridColsLabels[t]+"</a></span></p>"}else e+='<div class="wd_DgFlexSubDiv-f" style="width:'+this.cGridColsWidth[t]+'px;"><p class="wd_DgHeaderText" '+i+'"><span class="wd_Dg'+this.cModule+'HeaderTrigger">'+this.cStrings.gridColsLabels[t]+"</span></p>";e+="</div>"}document.getElementById("wd_Dg"+this.cModule+"ColHeader").innerHTML=DOMPurify.sanitize(e)}wg_do_simple_nav(){return'<div class="wd_DgVideoImgDiv"><div id="wd_Dg'+this.cModule+'LeftNavDivActive" class="wd_DgNavImg"><a href="#" title="'+vGenStrings.first+'"><img src="'+this.cImagesPath+this.cImgFIdle+'" id="wd_Dg'+this.cModule+'NavFirstImgTrigger" class="wd_Dg'+this.cModule+'NavImgTrigger" data-action="first" alt="first" /></a><a href="#" title="'+vGenStrings.prev+'"><img src="'+this.cImagesPath+this.cImgPIdle+'" id="wd_Dg'+this.cModule+'NavPrevImgTrigger" class="wd_Dg'+this.cModule+'NavImgTrigger" data-action="prev" alt="prev" /></a></div><div id="wd_Dg'+this.cModule+'LeftNavDiv" class="wd_DgNavImg"><img src="'+this.cImagesPath+this.cImgFIdle+'" alt="first" class="wd_DgOpacity5" /><img src="'+this.cImagesPath+this.cImgPIdle+'" alt="prev" class="wd_DgOpacity5" /></div></div><div class="wd_DgOffsetsDiv"><p class="wd_DgFooterText"><span id="wd_Dg'+this.cModule+'OffsetDropDown" title="'+vGenStrings.offset+'">'+this.wg_do_offsets()+'</span></p></div><div class="wd_DgVideoImgDiv"><div id="wd_Dg'+this.cModule+'RightNavDivActive" class="wd_DgNavImg"><a href="#" title="'+vGenStrings.next+'"><img src="'+this.cImagesPath+this.cImgNIdle+'" id="wd_Dg'+this.cModule+'NavNextImgTrigger" class="wd_Dg'+this.cModule+'NavImgTrigger" data-action="next" alt="next" /></a><a href="#" title="'+vGenStrings.last+'"><img src="'+this.cImagesPath+this.cImgLIdle+'" id="wd_Dg'+this.cModule+'NavLastImgTrigger" class="wd_Dg'+this.cModule+'NavImgTrigger" data-action="last" alt="last" /></a></div><div id="wd_Dg'+this.cModule+'RightNavDiv" class="wd_DgNavImg"><img src="'+this.cImagesPath+this.cImgNIdle+'" alt="next" class="wd_DgOpacity5" /><img src="'+this.cImagesPath+this.cImgLIdle+'" alt="last" class="wd_DgOpacity5" /></div></div>'}wg_update_grid_footer(){if(document.getElementById("wd_Dg"+this.cModule+"TotRecsSpan").textContent=this.cTotRecs,document.getElementById("wd_Dg"+this.cModule+"SelRecsSpan").textContent=this.cSelRecs,this.cTotRecs<=this.cOffset||this.cSelRecs<=this.cOffset)document.getElementById("wd_Dg"+this.cModule+"NavDiv").style.display="none";else{var e=this.wg_do_offsets();this.wg_do_nav(),document.getElementById("wd_Dg"+this.cModule+"OffsetDropDown").innerHTML=DOMPurify.sanitize(e),document.getElementById("wd_Dg"+this.cModule+"NavDiv").style.display=""}}wg_do_offsets(){return'<select id="wd_Dg'+this.cModule+'RecOffset" size="1" class="wd_DgInputBox">'+this.wg_do_select_options(this.cOffsets,"val",this.cOffset)+"</select>"}wg_do_nav(){switch(this.cNavAction){case"first":this.cStartRow=0,document.getElementById("wd_Dg"+this.cModule+"LeftNavDivActive").style.display="none",document.getElementById("wd_Dg"+this.cModule+"LeftNavDiv").style.display="",document.getElementById("wd_Dg"+this.cModule+"RightNavDivActive").style.display="",document.getElementById("wd_Dg"+this.cModule+"RightNavDiv").style.display="none";break;case"prev":(e=this.cStartRow-this.cOffset)<=0?(this.cStartRow=0,document.getElementById("wd_Dg"+this.cModule+"LeftNavDivActive").style.display="none",document.getElementById("wd_Dg"+this.cModule+"LeftNavDiv").style.display="",document.getElementById("wd_Dg"+this.cModule+"RightNavDivActive").style.display="",document.getElementById("wd_Dg"+this.cModule+"RightNavDiv").style.display="none"):(this.cStartRow=e,document.getElementById("wd_Dg"+this.cModule+"LeftNavDivActive").style.display="",document.getElementById("wd_Dg"+this.cModule+"LeftNavDiv").style.display="none",document.getElementById("wd_Dg"+this.cModule+"RightNavDivActive").style.display="",document.getElementById("wd_Dg"+this.cModule+"RightNavDiv").style.display="none");break;case"next":var e;(e=this.cStartRow+this.cOffset)>=this.cSelRecs?(this.cStartRow=this.cSelRecs-this.cOffset,document.getElementById("wd_Dg"+this.cModule+"LeftNavDivActive").style.display="",document.getElementById("wd_Dg"+this.cModule+"LeftNavDiv").style.display="none",document.getElementById("wd_Dg"+this.cModule+"RightNavDivActive").style.display="none",document.getElementById("wd_Dg"+this.cModule+"RightNavDiv").style.display=""):(this.cStartRow=e,document.getElementById("wd_Dg"+this.cModule+"LeftNavDivActive").style.display="",document.getElementById("wd_Dg"+this.cModule+"LeftNavDiv").style.display="none",document.getElementById("wd_Dg"+this.cModule+"RightNavDivActive").style.display="",document.getElementById("wd_Dg"+this.cModule+"RightNavDiv").style.display="none");break;case"last":this.cStartRow=this.cSelRecs-this.cOffset,document.getElementById("wd_Dg"+this.cModule+"LeftNavDivActive").style.display="",document.getElementById("wd_Dg"+this.cModule+"LeftNavDiv").style.display="none",document.getElementById("wd_Dg"+this.cModule+"RightNavDivActive").style.display="none",document.getElementById("wd_Dg"+this.cModule+"RightNavDiv").style.display=""}this.cNavAction=""}wg_set_grid_listeners(){var e=this;if(1==e.cShowTitle&&(Object.keys(e.cStrings.searchIn).length>0&&(document.getElementById("wd_Dg"+e.cModule+"SearchOn").addEventListener("change",(function(t){var i="wd_Dg"+e.cModule+"SearchFor";document.getElementById(i).value="",document.getElementById(i).focus()})),document.getElementById("wd_Dg"+e.cModule+"SearchFor").addEventListener("blur",(function(t){e.wg_build_filter()})),document.getElementById("wd_Dg"+e.cModule+"RemoveFilterTrigger").addEventListener("click",(function(t){e.wg_remove_filter()}))),""!=e.cDeleteCol&&1==e.cShowDeletedOpt)){var t="wd_Dg"+e.cModule+"ShowDelsTrigger";document.getElementById(t).addEventListener("click",(function(i){e.wg_set_checkbox(t),e.cStartRow=0,e.wg_refresh_grid_data()}))}document.getElementById("wd_Dg"+e.cModule+"ColHeader").addEventListener("click",(function(t){e.wg_set_sort_col(t.target.dataset.colid)})),(0==e.cHasSecurity||1==e.cHasSecurity&&"new"in e.cSecurity&&1==Number(e.cSecurity.new))&&1==e.cHasUuidCol&&1==e.cShowNewOpt&&document.getElementById("wd_Dg"+e.cModule+"AddNewImgTrigger").addEventListener("click",(function(t){e.wg_db_hook("new")}));var i=document.getElementById("wd_Dg"+e.cModule+"NavFirstImgTrigger");i.addEventListener("mouseenter",(function(t){i.setAttribute("src",e.cImagesPath+e.cImgFHover)})),i.addEventListener("mouseout",(function(t){i.setAttribute("src",e.cImagesPath+e.cImgFIdle)}));var s=document.getElementById("wd_Dg"+e.cModule+"NavPrevImgTrigger");s.addEventListener("mouseenter",(function(t){s.setAttribute("src",e.cImagesPath+e.cImgPHover)})),s.addEventListener("mouseout",(function(t){s.setAttribute("src",e.cImagesPath+e.cImgPIdle)}));var d=document.getElementById("wd_Dg"+e.cModule+"NavNextImgTrigger");d.addEventListener("mouseenter",(function(t){d.setAttribute("src",e.cImagesPath+e.cImgNHover)})),d.addEventListener("mouseout",(function(t){d.setAttribute("src",e.cImagesPath+e.cImgNIdle)}));var c=document.getElementById("wd_Dg"+e.cModule+"NavLastImgTrigger");c.addEventListener("mouseenter",(function(t){c.setAttribute("src",e.cImagesPath+e.cImgLHover)})),c.addEventListener("mouseout",(function(t){c.setAttribute("src",e.cImagesPath+e.cImgLIdle)}));for(var a=document.querySelectorAll(".wd_Dg"+e.cModule+"NavImgTrigger"),r=0;r<a.length;r++)a[r].addEventListener("click",(function(t){e.cNavAction=t.target.dataset.action,e.wg_do_nav(),e.wg_refresh_grid_data()}));var l=document.getElementById("wd_Dg"+e.cModule+"OffsetDropDown");1==!!document.getElementById("wd_Dg"+e.cModule+"RecOffset")&&l.addEventListener("change",(function(t){t.target.id=="wd_Dg"+e.cModule+"RecOffset"&&(e.cOffset=Number(t.target.value),e.wg_refresh_grid_data())}));var o=document.getElementById("wd_Dg"+e.cModule+"DataTable");e.cHidColCount>0&&(o.addEventListener("mouseover",(function(t){var i=t.target.dataset.idkey,s=t.target.id;if(null!=i&&s=="wd_Dg"+e.cModule+"ShowHideDivImg"+i){var d=t.target.dataset.action;if("show"==d)var c=e.cImgSDHover;else if("hide"==d)c=e.cImgSUHover;document.getElementById("wd_Dg"+e.cModule+"ShowHideDivImg"+i).setAttribute("src",e.cImagesPath+c)}})),o.addEventListener("mouseout",(function(t){var i=t.target.dataset.idkey,s=t.target.id;if(null!=i&&s=="wd_Dg"+e.cModule+"ShowHideDivImg"+i){var d=t.target.dataset.action;if("show"==d)var c=e.cImgSDIdle;else if("hide"==d)c=e.cImgSUIdle;document.getElementById("wd_Dg"+e.cModule+"ShowHideDivImg"+i).setAttribute("src",e.cImagesPath+c)}}))),o.addEventListener("click",(function(t){var i=t.target.dataset.idkey,s=t.target.dataset.action,d=t.target.id;if(null!=i){if(d=="wd_Dg"+e.cModule+"ShowHideDivImg"+i){var c="wd_Dg"+e.cModule+"ShowHideDivImg"+i;s=document.getElementById(c).dataset.action;e.wg_show_hide_div(s,c,e.cImgSUIdle,e.cImgSDIdle,"wd_Dg"+e.cModule+"HiddenDiv"+i,i)}(0==e.cHasSecurity||1==e.cHasSecurity&&"edit"in e.cSecurity&&1==Number(e.cSecurity.edit))&&t.target.parentNode.id=="wd_Dg"+e.cModule+"EditSpanRow"+i&&e.wg_db_hook("edit",i),d=="wd_Dg"+e.cModule+"RowImg"+s+i&&e.wg_db_hook(s,i)}}))}wg_build_filter(){this.cSearchOn=document.getElementById("wd_Dg"+this.cModule+"SearchOn").value,this.cSearchFor=document.getElementById("wd_Dg"+this.cModule+"SearchFor").value,""!=this.cSearchOn&&"0"!=this.cSearchOn&&"-"!=this.cSearchOn&&""!=this.cSearchFor&&"0"!=this.cSearchFor&&"-"!=this.cSearchFor&&(this.cStartRow=0,this.wg_refresh_grid_data())}wg_remove_filter(){this.cSearchOn="",this.cSearchFor="",this.cStartRow=0,document.getElementById("wd_Dg"+this.cModule+"SearchOn").value=Object.keys(this.cStrings.searchIn)[0],document.getElementById("wd_Dg"+this.cModule+"SearchFor").value="",this.wg_refresh_grid_data()}wg_set_sort_col(e){this.cOrderBy;0==this.cOrderDir?(this.cOrderDir=1,document.getElementById("wd_Dg"+this.cModule+"SortImg"+e).setAttribute("src",this.cImagesPath+this.cImgSortDsc)):(this.cOrderDir=0,document.getElementById("wd_Dg"+this.cModule+"SortImg"+e).setAttribute("src",this.cImagesPath+this.cImgSortAsc)),this.cOrderBy=e,this.wg_do_col_headers(),this.wg_refresh_grid_data()}wg_refresh_grid_data(){var e=this,t=document.getElementById("wd_Dg"+this.cModule+"DataTable");t.innerHTML=DOMPurify.sanitize('<div class="wd_DgDataMsgDiv"><img src="'+this.cImagesPath+'wait_ring_64.gif" class="wd_DgCenterImg" alt="" /></div>');var i=new XMLHttpRequest,s=e.cAjaxDataFunc+"?module="+e.wg_URL_encode(e.cModule)+"&db_table="+e.wg_URL_encode(e.DbTable)+"&query_cols="+e.wg_URL_encode(JSON.stringify(e.cQueryCols))+"&show_deleted="+e.cShowDeleted+"&order_by="+e.wg_URL_encode(e.cOrderColsMain[e.cOrderBy])+"&order_dir="+e.cOrderDirs[e.cOrderDir]+"&start_row="+e.cStartRow+"&offset="+e.cOffset+"&search_on="+e.wg_URL_encode(e.cSearchOn)+"&search_for="+e.wg_URL_encode(e.cSearchFor)+"&t="+Math.random();i.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if("text/html"==this.getResponseHeader("Content-Type").substring(0,9)){var i=JSON.parse(this.responseText);e.cTotRecs=Number(i.totRecs),e.cSelRecs=Number(i.selRecs),Object.hasOwn(i,"dbError")?t.innerHTML=DOMPurify.sanitize('<div class="wd_DgDataMsgDiv"><p class="wd_DgErrorClass">'+i.dbError+"</p></div>"):0==e.cTotRecs||0==e.cSelRecs?t.innerHTML=DOMPurify.sanitize('<div class="wd_DgDataMsgDiv"><p class="wd_DgInfoClass">'+vGenStrings.noData+"</p></div>"):t.innerHTML=DOMPurify.sanitize(e.wg_do_grid_db_data(i.theData)),e.wg_update_grid_footer()}else t.innerHTML=DOMPurify.sanitize('<div class="wd_DgDataMsgDiv"><p class="wd_DgInfoClass">'+vGenStrings.noData+"</p></div>")},i.open("GET",s,!0),i.send()}wg_do_grid_db_data(e){var t=this,i=JSON.parse(e),s=(Object.keys(i).length,!1),d=!1;(0==this.cHasSecurity||1==this.cHasSecurity&&"edit"in this.cSecurity&&1==Number(this.cSecurity.edit))&&(d=!0);var c="";for(const[e,g]of Object.entries(i)){var a=g[t.cUuidCol],r=t.wg_do_data_style(g),l=[];1==t.cHasUuidCol&&t.cUuidCol in g&&Number(g[t.cUuidCol])>0&&(s=!0),c+='<div class="wd_DgDataTableRow">',1==s&&t.cHidColCount>0?c+=t.wg_do_hidden_div_trigger(a):c+=t.wg_do_blank_column("15"),1==s&&1==d&&(c+='<a href="#" title="'+t.cStrings.editRow+'">'),c+='<div style="width:'+t.cDataWidth+'px;" class="wd_DgEditSpanRow" id="wd_Dg'+t.cModule+"EditSpanRow"+a+'">';for(var o=0;o<t.cColCount;o++)l[o]=t.wg_format_grid_col(a,g[t.cGridCols[o]],t.cGridColsType[o],t.cGridColsWidth[o]),c+='<div class="wd_DgTableText"'+r[o]+' data-idkey="'+a+'">'+l[o]+"</div>";if(c+="</div>",1==s&&1==d&&(c+="</a>"),c+=1==s?this.wg_set_icons(g):t.wg_do_blank_column("120"),c+="</div>",1==s&&t.cHidColCount>0){var n=[];for(o=0;o<t.cHidColCount;o++)n[o]=t.wg_format_grid_col(a,g[t.cHiddenCols[o]],t.cHiddenColsType[o]);c+=t.wg_do_hidden_data_div(a,n)}}return c}wg_do_hidden_div_trigger(e){return'<div class="wd_DgHiddenDivTriggerDiv"><a href="#"><img src="'+this.cImagesPath+this.cImgSDIdle+'" data-idkey="'+e+'" id="wd_Dg'+this.cModule+"ShowHideDivImg"+e+'" class="wd_Dg'+this.cModule+'ShowHideDivImgTrigger" title="'+vGenStrings.showHidden+'" data-action="show" alt="" /></a></div>'}wg_do_hidden_data_div(e,t){return'<div id="wd_Dg'+this.cModule+"HiddenDiv"+e+'" class="wd_Dg'+this.cModule+'GridHiddenData wd_DgHiddenDataDiv"><table>'+this.wg_set_hidden_data(t)+"</table></div>"}wg_show_hide_div(e,t,i,s,d,c){var a=document.getElementById(t),r=document.getElementById(d);if("show"==e){for(var l=document.querySelectorAll(".wd_Dg"+this.cModule+"ShowHideDivImgTrigger"),o=document.querySelectorAll(".wd_Dg"+this.cModule+"GridHiddenData"),n=0;n<o.length;n++)this.wg_hide_div(l[n],o[n],s);a.dataset.action="hide",a.setAttribute("title",vGenStrings.hideHidden),a.setAttribute("src",this.cImagesPath+i),r.style.display="block"}else"hide"==e&&this.wg_hide_div(a,r,s)}wg_hide_div(e,t,i){e.dataset.action="show",e.setAttribute("title",vGenStrings.showHidden),e.setAttribute("src",this.cImagesPath+i),t.style.display="none"}wg_do_data_style(e){for(var t=[],i=0;i<this.cColCount;i++)t[i]=' style="width:'+this.cGridColsWidth[i]+"px;",1==Number(e[this.cDeleteCol])?t[i]+=" font-weight:normal;text-decoration:line-through;":t[i]+=" font-weight:bold;",t[i]=this.wg_set_styles(t[i],e),""!=this.cGridColsAlign[i]&&(t[i]+="text-align:"+this.cGridColsAlign[i]+";"),t[i]+='"';return t}wg_format_grid_col(e,t,i,s){if(i.indexOf("|")>0){var d=i.split("|"),c=Number(t);if(1==Number.isNaN(c))return t;var a=1e3*c;return this.wg_date_format(a,d[0])+" - "+this.wg_date_format(a,d[1])}if("string"==i||"integer"==i)return t;if("float"==i)return Number(t).toLocaleString(this.cLocale,{minimumFractionDigits:this.cFloatDec,maximumFractionDigits:this.cFloatDec});if("currency"==i)return Number(t).toLocaleString(this.cLocale,{style:"currency",currency:vLocaleOpts.currency,currencyDisplay:"symbol",minimumFractionDigits:this.cCurrencyDec,maximumFractionDigits:this.cCurrencyDec});if(i.indexOf("date")>0||i.indexOf("time")>0){c=Number(t);return 1==Number.isNaN(c)?t:this.wg_date_format(1e3*c,i)}}wg_set_hidden_data(e){var t="",i="js_"+this.cModule+"_hidden_data";if("function"==typeof self[i])t=self[i](this.cModule,e,this.cImagesPath);else for(var s=0;s<this.cHidColCount;s++)e[s].length>0&&(t+='<table><tr><td><p class="wd_DgHiddenText"><b>'+this.cStrings.hiddenColsLabels[s]+'&nbsp;</b></p></td><td><p class="wd_DgHiddenText">'+e[s]+"</p></td></tr></table>");return t}wg_set_styles(e,t){var i="js_"+this.cModule+"_row_styles";return"function"==typeof self[i]?self[i](this.cModule,e,t,this.cDeleteCol):e}wg_set_icons(e){var t="",i="js_"+this.cModule+"_set_row_icons";if("function"==typeof self[i]&&(t=self[i](this.cModule,this.cSecurity,this.cDeleteCol,e,this.cStrings)),t.length>0){for(var s="",d=JSON.parse(t),c=Object.keys(d).length,a=0;a<c;a++)""==d[a].toolTip||""==d[a].iconName||""==d[a].action?s+=this.wg_do_blank_column("20"):s+='<div class="wd_DgLineIconImgDiv"><a href="#" title="'+this.wg_URL_decode(d[a].toolTip)+'"><p class="wd_DgTableImage"><img src="'+this.cImagesPath+d[a].iconName+'" id="wd_Dg'+this.cModule+"RowImg"+d[a].action+e[this.cUuidCol]+'" class="wd_Dg'+this.cModule+'RowImgTrigger" data-idkey="'+e[this.cUuidCol]+'" data-action="'+d[a].action+'" alt="'+d[a].action+'" /></p></a></div>';return s}return""}wg_db_hook(e,t="0"){var i=e.toLowerCase(),s="js_"+this.cModule+"_"+i+"_row";"function"==typeof self[s]&&self[s](this.cModule,this.DbTable,this.cUuidCol,t,this.cDeleteCol,this)}wg_date_format(e,t){if("function"==typeof self.js_wd_date_format)return js_wd_date_format(this.cModule,e,t,this.cLocale)}wg_do_blank_column(e){return'<div style="width:'+e+'px;">&nbsp;</div>'}wg_do_select_options(e,t="key",i=""){var s="";for(const[d,c]of Object.entries(e))s+=d==i?"val"==t?'<option selected="selected" value="'+c+'">'+c+"</option>":'<option selected="selected" value="'+d+'">'+c+"</option>":"val"==t?'<option value="'+c+'">'+c+"</option>":'<option value="'+d+'">'+c+"</option>";return s}wg_init_checkbox(e){const t=document.getElementById(e);0==this.cShowDeleted?t.setAttribute("src",this.cImagesPath+this.cImgUnCheck):t.setAttribute("src",this.cImagesPath+this.cImgCheck)}wg_set_checkbox(e){var t=document.getElementById(e);0==this.cShowDeleted?(t.setAttribute("src",this.cImagesPath+this.cImgCheck),this.cShowDeleted=1):(t.setAttribute("src",this.cImagesPath+this.cImgUnCheck),this.cShowDeleted=0)}wg_ucfirst(e){return e.charAt(0).toUpperCase()+e.substring(1,e.length)}wg_URL_encode(e){if("number"==typeof e)return e;var t=encodeURIComponent(e.replace("/","|")),i={"!":"%21","*":"%2a","+":"%2b",'"':"%22","'":"%27","(":"%28",")":"%29"};return t.replace(/[!*+"'()]/g,(function(e){return i[e]}))}wg_URL_decode(e){if("number"==typeof e)return e;var t={"%21":"!","%2a":"*","%2b":"+","%22":'"',"%27":"'","%28":"(","%29":")"},i=e.replace(/(%21)(%2a)(%2b)(%22)(%27)(%28)(%29)/,(function(e){return t[e]}));return decodeURIComponent(i)}}
